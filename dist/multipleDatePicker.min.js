angular.module("multipleDatePicker",[]).directive("multipleDatePicker",[function(){"use strict";return{restrict:"AE",scope:{callback:"&",dayClick:"=?",dayHover:"=?",daysSelected:"=?",weekDaysOff:"=?",daysOff:"=?",disallowBackPastMonths:"=",disallowGoFuturMonths:"="},template:'<div class="multiple-date-picker"><div class="picker-top-row"><div class="text-center picker-navigate" ng-class="{\'disabled\':disableBackButton}" ng-click="previousMonth()">&lt;</div><div class="text-center picker-month">{{month.format(\'MMMM YYYY\')}}</div><div class="text-center picker-navigate" ng-class="{\'disabled\':disableNextButton}" ng-click="nextMonth()">&gt;</div></div><div class="picker-days-week-row"><div class="text-center" ng-repeat="day in daysOfWeek">{{day}}</div></div><div class="picker-days-row"><div class="text-center picker-day picker-empty" ng-repeat="x in emptyFirstDays">&nbsp;</div><div class="text-center picker-day" ng-repeat="day in days" ng-click="toggleDay($event, day)" ng-mouseover="hoverDay($event, day, true)" ng-mouseleave="dayHover($event, day)" ng-class="{\'picker-selected\':day.selected, \'picker-off\':!day.selectable, \'today\':day.today}">{{day ? day.format(\'D\') : \'\'}}</div><div class="text-center picker-day picker-empty" ng-repeat="x in emptyLastDays">&nbsp;</div></div></div>',link:function(a){var b=function(){var b=moment(),c=moment(a.month).subtract(1,"month"),d=moment(a.month).add(1,"month");a.disableBackButton=a.disallowBackPastMonths&&b.isAfter(c,"month"),a.disableNextButton=a.disallowGoFuturMonths&&b.isBefore(d,"month")};a.$watch("daysSelected",function(b){if(b){var c=[];b.map(function(a){c.push(moment(a))}),a.convertedDaysSelected=c,a.generate()}}),a.$watch("callback",function(){a.generate()}),a.$watch("weekDaysOff",function(){a.generate()}),a.$watch("daysOff",function(){a.generate()}),a.month=a.month||moment().startOf("day"),a.days=[],a.convertedDaysSelected=a.convertedDaysSelected||[],a.weekDaysOff=a.weekDaysOff||[],a.daysOff=a.daysOff||[],a.disableBackButton=!1,a.disableNextButton=!1;var c=moment().localeData()._weekdaysMin;a.daysOfWeek=[c[1],c[2],c[3],c[4],c[5],c[6],c[0]],a.toggleDay=function(b,c){b.preventDefault();var d=!1;b.preventDefault=function(){d=!0},"function"==typeof a.dayClick&&a.dayClick(b,c),c.selectable&&!d&&(c.selected=!c.selected,c.selected?a.convertedDaysSelected.push(c):(a.convertedDaysSelected.filter(function(a){return a.valueOf()===c.valueOf()}),c.hover=!1),"function"==typeof a.callback&&a.callback({timestamp:c.valueOf(),selected:c.selected}))},a.hoverDay=function(b,c,d){b.preventDefault();var e=!1;b.preventDefault=function(){e=!0},"function"==typeof a.dayHover&&a.dayHover(b,c,d),e||(c.hover=d===!0?!0:!1)},a.previousMonth=function(){a.disableBackButton||(a.month=a.month.subtract(1,"month"),a.generate())},a.nextMonth=function(){a.disableNextButton||(a.month=a.month.add(1,"month"),a.generate())},a.isDayOff=function(a,b){return angular.isArray(a.weekDaysOff)&&a.weekDaysOff.some(function(a){return b.day()===a})||angular.isArray(a.daysOff)&&a.daysOff.some(function(a){return b.isSame(a,"day")})},a.isSelected=function(a,b){return a.convertedDaysSelected.some(function(a){return b.isSame(a,"day")})},a.generate=function(){var c=moment.utc(a.month).date(0),d=moment(a.month).date(1),e=[],f=moment(),g=moment(d).endOf("month"),h=g.date();a.emptyFirstDays=[];for(var i=0===d.day()?6:d.day()-1;i>0;i--)a.emptyFirstDays.push({});for(var j=0;h>j;j++){var k=moment(c.add(1,"days"));k.selectable=!a.isDayOff(a,k),k.selected=a.isSelected(a,k),k.today=k.isSame(f,"day"),e.push(k)}a.emptyLastDays=[];for(var l=7-(0===g.day()?7:g.day());l>0;l--)a.emptyLastDays.push({});a.days=e,b()},a.generate()}}}]);