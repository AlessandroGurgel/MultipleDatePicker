angular.module("multipleDatePicker",[]).directive("multipleDatePicker",[function(){"use strict";return{restrict:"AE",scope:{callback:"&",daysSelected:"=",weekDaysOff:"=",daysOff:"="},template:'<div class="multiple-date-picker"><div class="picker-top-row"><div class="text-center picker-navigate" ng-click="previousMonth()">&lt;</div><div class="text-center picker-month">{{month.format(\'MMMM YYYY\')}}</div><div class="text-center picker-navigate" ng-click="nextMonth()">&gt;</div></div><div class="picker-days-week-row"><div class="text-center" ng-repeat="day in daysOfWeek">{{day}}</div></div><div class="picker-days-row"><div class="text-center picker-day picker-empty" ng-repeat="x in emptyFirstDays">&nbsp;</div><div class="text-center picker-day" ng-repeat="day in days" ng-click="toggleDay(day)" ng-mouseover="day.hover=true" ng-mouseleave="day.hover=false" ng-class="{\'picker-selected\':day.selected, \'picker-off\':!day.selectable, \'hover\':day.hover && day.selectable, \'today\':day.today}">{{day ? day.format(\'D\') : \'\'}}</div><div class="text-center picker-day picker-empty" ng-repeat="x in emptyLastDays">&nbsp;</div></div></div>',link:function(a){a.$watch("daysSelected",function(b){if(b){var c=[];_.each(b,function(a){c.push(moment(a))}),a.convertedDaysSelected=c,a.generate()}}),a.$watch("callback",function(){a.generate()}),a.$watch("weekDaysOff",function(){a.generate()}),a.$watch("daysOff",function(){a.generate()}),a.month=a.month||moment().startOf("day"),a.days=[],a.convertedDaysSelected=a.convertedDaysSelected||[];var b=moment().lang()._weekdaysMin;a.daysOfWeek=[b[1],b[2],b[3],b[4],b[5],b[6],b[0]],a.toggleDay=function(b){b.selectable&&(b.selected=!b.selected,b.selected?a.convertedDaysSelected.push(b):(_.remove(a.convertedDaysSelected,function(a){return a.valueOf()===b.valueOf()}),b.hover=!1),"function"==typeof a.callback&&a.callback({timestamp:b.valueOf(),selected:b.selected}))},a.previousMonth=function(){a.month=a.month.subtract("month",1),a.generate()},a.nextMonth=function(){a.month=a.month.add("month",1),a.generate()},a.isDayOff=function(a,b){return _.any(a.weekDaysOff,function(a){return b.day()===a})||_.any(a.daysOff,function(a){return b.isSame(a,"day")})},a.isSelected=function(a,b){return _.any(a.convertedDaysSelected,function(a){return b.isSame(a,"day")})},a.generate=function(){var b=moment.utc(a.month).date(0),c=moment(a.month).date(1),d=[],e=moment(),f=moment(c).endOf("month"),g=f.date();a.emptyFirstDays=[];for(var h=0===c.day()?6:c.day()-1;h>0;h--)a.emptyFirstDays.push({});for(var i=0;g>i;i++){var j=moment(b.add("days",1));j.selectable=!a.isDayOff(a,j),j.selected=a.isSelected(a,j),j.today=j.isSame(e,"day"),d.push(j)}a.emptyLastDays=[];for(var k=7-(0===f.day()?7:f.day());k>0;k--)a.emptyLastDays.push({});a.days=d},a.generate()}}}]);